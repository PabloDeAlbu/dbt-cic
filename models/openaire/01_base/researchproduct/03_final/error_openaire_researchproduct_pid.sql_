{{ config(materialized='table') }}

WITH base as (
    SELECT
        researchproduct_id,
        arxiv,
        doi,
        handle,
        mag,
        pmc,
        pmid
    FROM {{ref('final_openaire_researchproduct_pid')}} rp
),

unique_id as (
    SELECT researchproduct_id
    FROM base
    GROUP BY 1
    HAVING COUNT(*) != 1
),

final as (
    SELECT * 
    FROM base
    WHERE researchproduct_id IN (SELECT researchproduct_id FROM unique_id)
)

SELECT * FROM final